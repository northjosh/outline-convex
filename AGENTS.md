# Outline – Agent Instructions

See `CLAUDE.md` for commands, architecture, and code style.

## Cursor Cloud specific instructions

### Services

| Service              | Port                                      | How to start                                                                                                    |
| -------------------- | ----------------------------------------- | --------------------------------------------------------------------------------------------------------------- |
| Convex local backend | 3210 (API), 3211 (HTTP), 6790 (dashboard) | `cd packages/backend && CONVEX_AGENT_MODE=anonymous CONVEX_DEPLOYMENT=anonymous:anonymous-agent npx convex dev` |
| Vite dev server      | 3001                                      | `cd apps/web && npx vite dev --port 3001 --host 0.0.0.0`                                                        |

### Starting the Convex local backend (non-interactive)

The injected `CONVEX_DEPLOYMENT` secret (`local:local-badbatch-outline`) requires Convex login, which fails in non-interactive terminals. Instead, override it:

```bash
cd packages/backend
CONVEX_AGENT_MODE=anonymous CONVEX_DEPLOYMENT=anonymous:anonymous-agent npx convex dev --tail-logs disable
```

This starts a local Convex backend without requiring authentication. After starting, set the `SITE_URL` Convex environment variable:

```bash
CONVEX_DEPLOYMENT=anonymous:anonymous-agent npx convex env set SITE_URL http://localhost:3001
```

### Environment files

- `apps/web/.env.local` — needs `VITE_CONVEX_URL` and `VITE_CONVEX_SITE_URL` pointing to the local backend (usually `http://127.0.0.1:3210` and `http://127.0.0.1:3211`).
- `packages/backend/.env.local` — auto-generated by `convex dev`, contains `CONVEX_DEPLOYMENT`, `CONVEX_URL`, `CONVEX_SITE_URL`.

### Convex environment variables (set after backend starts)

After the Convex backend is running, set these Convex-side env vars:

```bash
cd packages/backend
CONVEX_DEPLOYMENT=anonymous:anonymous-agent npx convex env set SITE_URL http://localhost:3001
CONVEX_DEPLOYMENT=anonymous:anonymous-agent npx convex env set BETTER_AUTH_SECRET "any-dev-secret-string"
```

### Gotchas

- The `CONVEX_DEPLOYMENT` secret injected into the environment (`local:local-badbatch-outline`) requires interactive login. Always override it with `CONVEX_DEPLOYMENT=anonymous:anonymous-agent` and `CONVEX_AGENT_MODE=anonymous` when starting the backend.
- `npx convex dev --once` fails if the Convex local backend is already running on port 3210. Use `npx convex typecheck` for type checking without a running dev server.
- Convex functions run server-side in the Convex runtime, not in Node/Bun. The `SITE_URL` and `BETTER_AUTH_SECRET` env vars must be set via `npx convex env set`, not in `.env.local`.
- `BETTER_AUTH_SECRET` is required — without it, all auth HTTP endpoints return 500. Any non-empty string works for local dev.
- `SITE_URL` must be the frontend origin (e.g. `http://localhost:3001`) for CORS to work. Setting it to the backend URL will break authentication.
- Lint: `bun check` (oxlint + oxfmt). Type check: `bun check-types`. No test framework is configured.
